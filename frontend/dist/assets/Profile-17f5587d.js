import{l as u,d as l,o as _,n as V,f as t,e,g as B,c as N,F as A,m as U,h as f,v as g,k as n,t as b,L as T}from"./index-0242c6eb.js";import{c as w,a as C}from"./index.esm-eb5145b9.js";import{v as D}from"./vue-dropzone-bf095dac.js";import{_ as L}from"./_plugin-vue_export-helper-c27b6911.js";const G={beforeCreate(){this.checkUser=u.debounce(o=>{const r=u.pick(o,["first_name","last_name","phone_number","address","gender","email"]),i=this;console.log(r),u.each(r,(c,s)=>{i.validateProfile(s,r)})},1e3)},beforeRouteEnter(o,r,i){i(c=>{c.fetchUser(),i()})},components:{vueDropzone:D},computed:{authToken(){return this.$store.getters.authToken},backendUri(){return this.env.VITE_API_BASE_URL.replace("api","")},env(){return this.$store.getters.env}},data(){return{edit:{image:!1},dropzoneOptions:{url:"https://httpbin.org/post",thumbnailWidth:300,maxFilesize:2,headers:{}},errors:{},user:{address:"",first_name:"",last_name:"",email:"",image:"",gender:"",phone_number:""},isDisabled:!1}},created(){this.$isEmpty=u.isEmpty,this.$has=u.has,this.userSchema=w().shape({address:C().required("*Address is required"),first_name:C().required("*First Name is required"),last_name:C().required("*Last Name is required"),email:C().email("*Enter a valid email address").required("*Email address is required"),gender:C(),phone_number:C().required("*Phone number is required")}),this.imageUpdate=u.debounce(()=>{this.fetchUser()},1e3)},methods:{fetchUser(){const{authToken:o,env:{VITE_API_BASE_URL:r},edit:i}=this;this.$store.commit("loader",!0),this.$api.get("/auth/user").then(({data:{user:c}})=>{this.user=c,this.dropzoneOptions.url=`${r}/auth/upload/image`,this.dropzoneOptions.headers={Authorization:`${o.token_type} ${o.token}`}}).catch(({response:c})=>{}).finally(()=>{i.image&&(this.edit.image=!1),this.$store.commit("loader",!1)})},updateUser(){this.$store.commit("loader",!0),this.isDisabled=!0,this.$api.post("/auth/user",u.pick(this.user,["first_name","last_name","phone_number","address","gender","email"])).then(({data:{user:o}})=>{}).catch(({response:o})=>{}).finally(()=>{this.$store.commit("loader",!1)})},validateProfile(o,r){this.userSchema.validateAt(o,r).then((i,c)=>{delete this.errors[o]}).catch(i=>{this.errors[i.path]=i.message})}},watch:{errors:{handler(o){this.isDisabled=!u.isEmpty(o)},deep:!0},user:{handler(o){this.checkUser(o)},deep:!0,immediate:!0}}},O=n("h5",{class:"mb-0"},"User Profile",-1),R=n("hr",{class:"mb-2 mt-2"},null,-1),M=n("h6",{class:"mb-2"},"Profile Image",-1),$=n("h6",{class:"my-4"},"User details",-1),j=n("option",null,"Open to select gender",-1),W=n("option",{value:"male"},"Male",-1),H=n("option",{value:"female"},"Female",-1),J=n("option",{value:""},"Prefer Not To Say",-1);function K(o,r,i,c,s,k){const d=l("CCol"),E=l("vue-dropzone"),z=l("CImage"),m=l("CIcon"),S=l("CButton"),y=l("CRow"),p=l("CInputGroupText"),v=l("CFormInput"),h=l("CInputGroup"),I=l("CFormSelect"),F=l("CSpinner"),x=l("CForm"),P=l("CCardBody"),q=l("CCard");return _(),V(d,{lg:"6",md:"8",xs:"12"},{default:t(()=>[e(q,{style:{"min-height":"100vh"}},{default:t(()=>[e(P,null,{default:t(()=>[e(y,null,{default:t(()=>[e(d,{md:"12",xs:"12"},{default:t(()=>[O,R]),_:1}),e(d,{md:"8",xs:"12"},{default:t(()=>[e(x,{onSubmit:B(k.updateUser,["prevent"]),autocomplete:"off"},{default:t(()=>[e(y,null,{default:t(()=>[e(d,{md:12,xs:12},{default:t(()=>[M]),_:1}),e(d,{md:12,xs:12},{default:t(()=>[s.edit.image?(_(),V(E,{key:0,ref:"dropzoneLogo",onVdropzoneSuccess:o.imageUpdate,id:"dropzoneLogo",options:s.dropzoneOptions},null,8,["onVdropzoneSuccess","options"])):(_(),N(A,{key:1},[o.$isEmpty(s.user.image)?(_(),V(m,{key:1,name:"cil-image"})):(_(),V(z,{key:0,align:"center",thumbnail:"",class:"col-12",src:`${k.backendUri}${s.user.image}`,fluid:""},null,8,["src"]))],64))]),_:1}),e(d,{md:12,xs:12,class:"text-center mt-2"},{default:t(()=>[e(S,{color:"light",size:"sm",onClick:r[0]||(r[0]=a=>s.edit.image=!0)},{default:t(()=>[e(m,{name:"cil-pencil"}),U(" Edit Logo ")]),_:1})]),_:1})]),_:1}),e(d,{md:12,xs:12},{default:t(()=>[$]),_:1}),e(h,{class:"mb-3"},{default:t(()=>[e(p,null,{default:t(()=>[e(m,{icon:"cil-user"})]),_:1}),e(v,{placeholder:"First Name",modelValue:s.user.first_name,"onUpdate:modelValue":r[1]||(r[1]=a=>s.user.first_name=a),autocomplete:"off",disabled:o.$store.getters.loader},null,8,["modelValue","disabled"]),f(n("p",{class:"text-danger col col-12 mb-0"},b(s.errors.first_name),513),[[g,o.$has(s.errors,"first_name")]])]),_:1}),e(h,{class:"mb-3"},{default:t(()=>[e(p,null,{default:t(()=>[e(m,{icon:"cil-user"})]),_:1}),e(v,{placeholder:"Last Name",modelValue:s.user.last_name,"onUpdate:modelValue":r[2]||(r[2]=a=>s.user.last_name=a),autocomplete:"off",disabled:o.$store.getters.loader},null,8,["modelValue","disabled"]),f(n("p",{class:"text-danger col col-12 mb-0"},b(s.errors.last_name),513),[[g,o.$has(s.errors,"last_name")]])]),_:1}),e(h,{class:"mb-3"},{default:t(()=>[e(p,null,{default:t(()=>[e(m,{icon:"cilEnvelope"})]),_:1}),e(v,{disabled:"",placeholder:"Email",modelValue:s.user.email,"onUpdate:modelValue":r[3]||(r[3]=a=>s.user.email=a),autocomplete:"off"},null,8,["modelValue"]),f(n("p",{class:"text-danger col col-12 mb-0"},b(s.errors.email),513),[[g,o.$has(s.errors,"email")]])]),_:1}),e(h,{class:"mb-3"},{default:t(()=>[e(p,null,{default:t(()=>[e(m,{icon:"cilPhone"})]),_:1}),e(v,{placeholder:"Phone Number",modelValue:s.user.phone_number,"onUpdate:modelValue":r[4]||(r[4]=a=>s.user.phone_number=a),autocomplete:"off",disabled:o.$store.getters.loader},null,8,["modelValue","disabled"]),f(n("p",{class:"text-danger col col-12 mb-0"},b(s.errors.phone_number),513),[[g,o.$has(s.errors,"phone_number")]])]),_:1}),e(h,{class:"mb-3"},{default:t(()=>[e(p,null,{default:t(()=>[e(m,{icon:"cilAddressbook"})]),_:1}),e(I,{"aria-label":"Gender",modelValue:s.user.gender,"onUpdate:modelValue":r[5]||(r[5]=a=>s.user.gender=a),disabled:o.$store.getters.loader},{default:t(()=>[j,W,H,J]),_:1},8,["modelValue","disabled"]),f(n("p",{class:"text-danger col col-12 mb-0"},b(s.errors.gender),513),[[g,o.$has(s.errors,"gender")]])]),_:1}),e(h,{class:"mb-3"},{default:t(()=>[e(p,null,{default:t(()=>[e(m,{icon:"cil-address-book"})]),_:1}),e(v,{placeholder:"Address",modelValue:s.user.address,"onUpdate:modelValue":r[6]||(r[6]=a=>s.user.address=a),autocomplete:"off",disabled:o.$store.getters.loader},null,8,["modelValue","disabled"]),f(n("p",{class:"text-danger col col-12 mb-0"},b(s.errors.address),513),[[g,o.$has(s.errors,"address")]])]),_:1}),e(d,{md:12,xs:12,class:"d-flex justify-content-end"},{default:t(()=>[e(S,{color:"success",class:"text-light",disabled:s.isDisabled,type:"submit"},{default:t(()=>[s.isDisabled&&o.$store.getters.loader?(_(),V(F,{key:0,component:"span",size:"sm",variant:"grow","aria-hidden":"true"})):T("",!0),U(" Save Changes ")]),_:1},8,["disabled"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}const ee=L(G,[["render",K]]);export{ee as default};
