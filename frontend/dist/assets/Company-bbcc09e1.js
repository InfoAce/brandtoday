import{l as c,d as r,o as i,n as u,f as n,e,g as q,c as E,F as U,m as S,h as g,v as C,k as h,t as b,L as w}from"./index-0242c6eb.js";import{c as F,a as k}from"./index.esm-eb5145b9.js";import{v as O}from"./vue-dropzone-bf095dac.js";import{_ as T}from"./_plugin-vue_export-helper-c27b6911.js";const N={beforeCreate(){this.checkCompany=c.debounce(t=>{const s=c.pick(t,["name","phone_number","address","email"]),l=this;c.each(s,(m,o)=>{l.validateCompany(o,s)})},500)},beforeRouteEnter(t,s,l){l(m=>{m.fetchCompany(),l()})},components:{vueDropzone:O},computed:{authToken(){return this.$store.getters.authToken},backendUri(){return this.env.VITE_API_BASE_URL.replace("api","")},env(){return this.$store.getters.env}},data(){return{edit:{icon:!1,logo:!1},errors:{},company:{address:"",first_name:"",last_name:"",email:"",icon:"",logo:"",gender:"",phone_number:""},dropzoneLogoOptions:{url:"https://httpbin.org/post",thumbnailWidth:300,maxFilesize:2,headers:{}},dropzoneIconOptions:{url:"https://httpbin.org/post",thumbnailWidth:300,maxFilesize:.5,headers:{}},isDisabled:!0}},created(){this.$isEmpty=c.isEmpty,this.$has=c.has,this.companySchema=F().shape({address:k().required("*Address is required"),name:k().required("*Name is required"),email:k().email("*Enter a valid email address").required("*Email address is required"),phone_number:k().required("*Phone number is required")}),this.imageUpdate=c.debounce(()=>{this.fetchCompany()},1e3)},methods:{fetchCompany(){const{authToken:t,env:{VITE_API_BASE_URL:s},edit:l}=this;this.$store.commit("loader",!0),this.$api.get("/auth/company").then(({data:{company:m}})=>{this.company=m,this.dropzoneLogoOptions.url=`${s}/company/${m.id}/upload/logo`,this.dropzoneLogoOptions.headers={Authorization:`${t.token_type} ${t.token}`},this.dropzoneIconOptions.url=`${s}/company/${m.id}/upload/icon`,this.dropzoneIconOptions.headers={Authorization:`${t.token_type} ${t.token}`}}).catch(({response:m})=>{}).finally(()=>{l.logo&&(this.edit.logo=!1),l.icon&&(this.edit.icon=!1),this.$store.commit("loader",!1)})},updateCompany(){this.$store.commit("loader",!0),this.isDisabled=!0,this.$api.post("/auth/company",c.pick(this.company,["name","phone_number","address","email"])).then(({data:{company:t}})=>{}).catch(({response:t})=>{}).finally(()=>{this.$store.commit("loader",!1)})},validateCompany(t,s){this.companySchema.validateAt(t,s).then((l,m)=>{delete this.errors[t]}).catch(l=>{this.errors[l.path]=l.message})}},watch:{errors:{handler(t){this.isDisabled=!c.isEmpty(t)},deep:!0},company:{handler(t){this.checkCompany(t)},deep:!0,immediate:!0}}},$=h("h5",null,"Company Details",-1),R=h("h6",{class:"mb-2"},"Company Logo",-1),G=h("h6",{class:"mb-2"},"Company Icon",-1),P=h("h6",{class:"my-4"},"Company details",-1);function W(t,s,l,m,o,z){const a=r("CCol"),I=r("vue-dropzone"),V=r("CImage"),p=r("CIcon"),v=r("CButton"),x=r("CRow"),f=r("CInputGroupText"),_=r("CFormInput"),y=r("CInputGroup"),L=r("CSpinner"),B=r("CForm"),A=r("CCardBody"),D=r("CCard");return i(),u(a,{lg:"6",md:"8",xs:"12"},{default:n(()=>[e(D,{style:{"min-height":"100vh"}},{default:n(()=>[e(A,null,{default:n(()=>[e(x,null,{default:n(()=>[e(a,{md:"12",xs:"12"},{default:n(()=>[$]),_:1}),e(a,{md:"8",xs:"12"},{default:n(()=>[e(B,{autocomplete:"off",onSubmit:q(z.updateCompany,["prevent"])},{default:n(()=>[e(x,null,{default:n(()=>[e(a,{md:12,xs:12},{default:n(()=>[R]),_:1}),e(a,{md:12,xs:12},{default:n(()=>[o.edit.logo?(i(),u(I,{key:0,ref:"dropzoneLogo",onVdropzoneSuccess:t.imageUpdate,id:"dropzoneLogo",options:o.dropzoneLogoOptions},null,8,["onVdropzoneSuccess","options"])):(i(),E(U,{key:1},[t.$isEmpty(o.company.logo)?(i(),u(p,{key:1,name:"cil-image"})):(i(),u(V,{key:0,align:"center",class:"col-12",thumbnail:"",src:`${z.backendUri}${o.company.logo}`,fluid:""},null,8,["src"]))],64))]),_:1}),e(a,{md:12,xs:12,class:"text-center my-2"},{default:n(()=>[e(v,{color:"light",size:"sm",onClick:s[0]||(s[0]=d=>o.edit.logo=!0)},{default:n(()=>[e(p,{name:"cil-pencil"}),S(" Edit Logo ")]),_:1})]),_:1}),e(a,{md:12,xs:12},{default:n(()=>[G]),_:1}),e(a,{md:12,xs:12},{default:n(()=>[o.edit.icon?(i(),u(I,{key:0,onVdropzoneSuccess:t.imageUpdate,ref:"dropzoneIcon",id:"dropzoneIcon",options:o.dropzoneIconOptions},null,8,["onVdropzoneSuccess","options"])):(i(),E(U,{key:1},[t.$isEmpty(o.company.icon)?(i(),u(p,{key:1,name:"cil-image"})):(i(),u(V,{key:0,align:"center",class:"col-12",thumbnail:"",src:`${z.backendUri}${o.company.icon}`,fluid:""},null,8,["src"]))],64))]),_:1}),e(a,{md:12,xs:12,class:"text-center my-2"},{default:n(()=>[e(v,{color:"light",size:"sm",onClick:s[1]||(s[1]=d=>o.edit.icon=!0)},{default:n(()=>[e(p,{name:"cil-pencil"}),S(" Edit Icon ")]),_:1})]),_:1})]),_:1}),e(a,{md:12,xs:12},{default:n(()=>[P]),_:1}),e(y,{class:"mb-3"},{default:n(()=>[e(f,null,{default:n(()=>[e(p,{icon:"cil-user"})]),_:1}),e(_,{placeholder:"Name",modelValue:o.company.name,"onUpdate:modelValue":s[2]||(s[2]=d=>o.company.name=d),autocomplete:"off"},null,8,["modelValue"]),g(h("p",{class:"text-danger col col-12 mb-0"},b(o.errors.name),513),[[C,t.$has(o.errors,"name")]])]),_:1}),e(y,{class:"mb-3"},{default:n(()=>[e(f,null,{default:n(()=>[e(p,{icon:"cil-envelope"})]),_:1}),e(_,{disabled:"",placeholder:"Email",modelValue:o.company.email,"onUpdate:modelValue":s[3]||(s[3]=d=>o.company.email=d),autocomplete:"off"},null,8,["modelValue"]),g(h("p",{class:"text-danger col col-12 mb-0"},b(o.errors.email),513),[[C,t.$has(o.errors,"email")]])]),_:1}),e(y,{class:"mb-3"},{default:n(()=>[e(f,null,{default:n(()=>[e(p,{icon:"cil-phone"})]),_:1}),e(_,{placeholder:"Phone Number",type:"number",modelValue:o.company.phone_number,"onUpdate:modelValue":s[4]||(s[4]=d=>o.company.phone_number=d),autocomplete:"off"},null,8,["modelValue"]),g(h("p",{class:"text-danger col col-12 mb-0"},b(o.errors.phone_number),513),[[C,t.$has(o.errors,"phone_number")]])]),_:1}),e(y,{class:"mb-3"},{default:n(()=>[e(f,null,{default:n(()=>[e(p,{icon:"cil-address-book"})]),_:1}),e(_,{placeholder:"Address",modelValue:o.company.address,"onUpdate:modelValue":s[5]||(s[5]=d=>o.company.address=d),autocomplete:"off"},null,8,["modelValue"]),g(h("p",{class:"text-danger col col-12 mb-0"},b(o.errors.address),513),[[C,t.$has(o.errors,"address")]])]),_:1}),e(a,{md:12,xs:12,class:"d-flex justify-content-end"},{default:n(()=>[e(v,{color:"success",class:"text-light",disabled:o.isDisabled,type:"submit"},{default:n(()=>[o.isDisabled&&t.$store.getters.loader?(i(),u(L,{key:0,component:"span",size:"sm",variant:"grow","aria-hidden":"true"})):w("",!0),S(" Save Changes ")]),_:1},8,["disabled"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}const K=T(N,[["render",W]]);export{K as default};
